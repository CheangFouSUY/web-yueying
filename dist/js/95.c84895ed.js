"use strict";(self["webpackChunkse_project"]=self["webpackChunkse_project"]||[]).push([[95],{5095:function(t,e,i){i.d(e,{Z:function(){return p}});var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-row",{staticClass:"feed-box"},[t.isPin||t.isFeatured?s("div",{staticClass:"feed-tag"}):t._e(),t.isPin?s("span",{staticClass:"feed-tag-span"},[t._v("置顶")]):t._e(),t.isFeatured&&!t.isPin?s("span",{staticClass:"feed-tag-span"},[t._v("精华")]):t._e(),t.isAdmin||t.isMine?s("el-dropdown",{attrs:{trigger:"click"}},[s("i",{staticClass:"el-icon-more"}),s("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t.isAdmin&&!t.isPin?s("el-dropdown-item",{nativeOn:{click:function(e){return t.pin()}}},[t._v("置顶")]):t.isAdmin&&t.isPin?s("el-dropdown-item",{nativeOn:{click:function(e){return t.pin()}}},[t._v("取消置顶")]):t._e(),t.isAdmin&&!t.isFeatured?s("el-dropdown-item",{nativeOn:{click:function(e){return t.feature()}}},[t._v("精华")]):t._e(),t.isAdmin&&t.isFeatured?s("el-dropdown-item",{nativeOn:{click:function(e){return t.feature()}}},[t._v("取消精华")]):t._e(),t.isMine||t.isAdmin?s("el-dropdown-item",{nativeOn:{click:function(e){t.deleteDialogVisible=!0}}},[t._v("删除帖子")]):t._e()],1)],1):t._e(),s("el-dialog",{attrs:{title:"删除帖子",visible:t.deleteDialogVisible,width:"30%"},on:{"update:visible":function(e){t.deleteDialogVisible=e}}},[s("span",[t._v("确认是否需要删除帖子")]),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.deleteDialogVisible=!1}}},[t._v("取 消")]),s("el-button",{attrs:{type:"primary"},on:{click:function(e){t.deleteDialogVisible=!1,t.deleteFeed()}}},[t._v("确 定")])],1)]),s("el-row",{attrs:{gutter:70,align:"middle",type:"flex"}},[s("el-col",{attrs:{span:1}},[t.publisherAvatar?s("el-avatar",{attrs:{size:50,src:t.publisherAvatar},nativeOn:{click:function(e){return t.enterProfile(t.createdBy)}}}):s("el-avatar",{attrs:{size:50,icon:"el-icon-user-solid"},on:{click:function(e){return t.enterProfile(t.createdBy)}}})],1),s("el-col",{attrs:{span:20}},[s("el-row",{staticClass:"feed-publisher"},[t.isGroup||t.isPublic?t._e():s("span",[t._v(t._s(t.groupName))]),t.isGroup||t.isPublic?t._e():s("el-divider",{attrs:{direction:"vertical"}}),s("span",{staticStyle:{cursor:"pointer"},on:{click:function(e){return t.enterProfile(t.createdBy)}}},[t._v(" "+t._s(t.publisherName)+" ")])],1),s("el-row",{staticClass:"feed-time"},[s("i",{staticClass:"el-icon-time"}),t._v(" "+t._s(t.dateStr(t.createdAt))+" ")])],1)],1),s("el-row",{staticClass:"feed-title"},[s("span",{on:{click:function(e){return t.enterFeed()}}},[t._v(t._s(t.title))])]),s("el-row",{staticClass:"feed-content"},[t.isPublic?s("span",{staticClass:"feed-hashtag",on:{click:function(e){return t.enterTag(t.belongTag)}}},[t._v("#"+t._s(t.tagTitle)+"#")]):t._e(),s("span",{domProps:{innerHTML:t._s(t.descriptionCalc())}})]),s("el-row",{attrs:{type:"flex",justify:"end"}},[t.isNeedExpand&&!t.isShowComment?s("div",[!1===this.isExpand?s("button",{staticClass:"expand-button",on:{click:function(e){return t.changeExpand()}}},[t._v(" 展开"),s("i",{staticClass:"el-icon-arrow-down"})]):s("button",{staticClass:"expand-button",on:{click:function(e){return t.changeExpand()}}},[t._v(" 收起"),s("i",{staticClass:"el-icon-arrow-up"})])]):t._e()]),s("el-row",{staticClass:"feed-image",attrs:{type:"flex",justify:"center"}},[t.image?s("img",{attrs:{src:t.image,alt:"feed-image"}}):t._e()]),s("el-row",{staticClass:"like-comment-wrap"},["L"===t.response?s("img",{attrs:{src:i(392),alt:"love"},on:{click:function(e){return t.like()}}}):s("img",{attrs:{src:i(7970),alt:"love"},on:{click:function(e){return t.like()}}}),s("span",{staticClass:"like-count"},[t._v(t._s(t.likeCount))]),s("img",{attrs:{src:i(2392),alt:"comment"},on:{click:function(e){return t.enterFeed()}}}),s("span",{staticClass:"comment-count"},[t._v(t._s(t.commentCount))]),s("img",{attrs:{src:i(506),alt:"report icon"},on:{click:function(e){return t.report("f&"+t.id)}}})]),t.isShowComment?s("div",{staticClass:"comment-wrap"},[t.islogin?s("el-row",{staticClass:"publish-box"},[s("el-row",{attrs:{gutter:70}},[s("el-col",{attrs:{span:1}},[t.userAvatar?s("el-avatar",{attrs:{size:50,src:t.userAvatar}}):s("el-avatar",{attrs:{size:50,icon:"el-icon-user-solid"}})],1),s("el-col",{attrs:{span:22}},[s("el-row",{staticClass:"comment-publisher"},[t._v(t._s(t.user))]),s("el-row",{staticClass:"publish-write"},[s("form",[s("div",{staticClass:"comment-autosize-wrapper"},[s("pre",{staticClass:"comment-autosize"},[t._v("                    "),s("br"),t._v(t._s(t.userComment.content)+"\n                  ")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.userComment.content,expression:"userComment.content"}],attrs:{placeholder:"留下评论："},domProps:{value:t.userComment.content},on:{input:function(e){e.target.composing||t.$set(t.userComment,"content",e.target.value)}}})]),s("span",{staticClass:"showFileName"}),t.userComment.img?s("i",{staticClass:"el-icon-delete",staticStyle:{cursor:"pointer"},on:{click:function(e){return t.deleteImg()}}}):t._e(),s("input",{attrs:{id:"imgUpload",type:"file",accept:"image/png,image/gif,image/jpeg"},on:{change:function(e){return t.getImg(e)}}}),s("el-row",{staticClass:"publish-action",attrs:{span:20}},[s("i",{staticClass:"el-icon-picture-outline-round",attrs:{onclick:"$('input[id=imgUpload]').click();"}}),s("i",{staticClass:"el-icon-position",on:{click:function(e){return t.submitReview(e)}}})])],1)])],1)],1)],1):t._e(),t._l(t.comments,(function(e){return s("el-row",{key:e.id,staticClass:"comment-box"},[s("el-divider"),s("br"),s("el-row",{attrs:{gutter:70}},[s("el-col",{attrs:{span:1}},[e.publisherAvatar?s("el-avatar",{attrs:{size:50,src:e.publisherAvatar},nativeOn:{click:function(i){return t.enterProfile(e.createdBy)}}}):s("el-avatar",{attrs:{size:50,icon:"el-icon-user-solid"},nativeOn:{click:function(i){return t.enterProfile(e.createdBy)}}})],1),s("el-col",{attrs:{span:22}},[t.status?s("el-row",{on:{click:function(i){return t.enterProfile(e.createdBy)}}},[s("span",{staticClass:"comment-publisher",on:{click:function(i){return t.enterProfile(e.createdBy)}}},[t._v(t._s(e.publisherName))])]):t._e(),t.status?s("el-row",{staticClass:"comment-time"},[s("i",{staticClass:"el-icon-time"}),t._v(" "+t._s(t.dateStr(e.time))+" ")]):t._e(),s("span",{staticStyle:{"word-wrap":"break-word"},domProps:{innerHTML:t._s(t.contentCalc(e.description))}}),e.img?s("img",{staticClass:"comment-image",attrs:{src:e.img,alt:"comment-image"}}):t._e()],1)],1),s("el-row",{staticClass:"comment-action"},[s("el-col",{attrs:{span:3,offset:5}},[s("el-row",{attrs:{type:"flex",justify:"center"}},["L"===e.response?s("img",{attrs:{src:i(9337),alt:"happy icon"},on:{click:function(i){return t.commentResponse(e,"O")}}}):s("img",{attrs:{src:i(1816),alt:"happy icon"},on:{click:function(i){return t.commentResponse(e,"L")}}})]),s("el-row",{staticClass:"comment-like-count",attrs:{type:"flex",justify:"center"}},[t._v(t._s(e.likes))])],1),s("el-col",{attrs:{span:3,offset:1}},[s("el-row",{attrs:{type:"flex",justify:"center"}},["D"===e.response?s("img",{attrs:{src:i(4714),alt:"sad icon"},on:{click:function(i){return t.commentResponse(e,"O")}}}):s("img",{attrs:{src:i(5414),alt:"sad icon"},on:{click:function(i){return t.commentResponse(e,"D")}}})]),s("el-row",{staticClass:"comment-like-count",attrs:{type:"flex",justify:"center"}},[t._v(t._s(e.dislikes))])],1),s("el-col",{attrs:{span:3,offset:1}},[s("el-row",{attrs:{type:"flex",justify:"center"}},[s("img",{attrs:{id:"report",src:i(506),alt:"report icon"},on:{click:function(i){return t.report("r&"+e.id)}}})])],1)],1)],1)}))],2):t._e()],1)],1)},a=[],o=i(2282),n={name:"FeedBox",props:{initialFeedId:String,initialIsInnerpage:Boolean,initialIsGroup:Boolean,initialIsPin:Boolean,initialIsFeatured:Boolean,initialIsAdmin:Boolean},data(){return{status:!1,islogin:!1,deleteDialogVisible:!1,user:"",userId:"",userAvatar:"",id:this.initialFeedId,createdBy:"",publisherName:"",publisherAvatar:"",isMine:!1,createdAt:"",isPublic:!0,belongTo:"",belongTag:"",tagTitle:"",isPin:this.initialIsPin,isFeatured:this.initialIsFeatured,isAdmin:this.initialIsAdmin,isGroup:this.initialIsGroup,groupName:"",title:"",description:"",isExpand:!1,image:"",likeCount:0,commentCount:0,isShowComment:this.initialIsInnerpage,response:"O",userComment:{content:"",img:""},comments:[]}},mounted(){var t;(t=o.Z.getters.getUser(o.Z.state()))&&(this.islogin=!0,this.userId=t.user.id),this.getAll()},computed:{isNeedExpand(){return this.description.length<=180&&(this.isExpand=!0),this.description.length>180}},methods:{async deleteFeed(){var t=new FormData;t.append("feedId",this.id),this.isPublic||t.append("groupId",this.belongTo);var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),await this.$axios({method:"delete",url:"/api/v1/feed/"+this.id,data:t,headers:e}).then((t=>{console.log(t),this.initialIsInnerpage?this.$router.push("/feed"):location.reload()})).catch((t=>{console.log(t)}))},async feature(){var t=new FormData;t.append("feedId",this.id),t.append("groupId",this.belongTo);var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),await this.$axios({method:"put",url:"/api/v1/group/setFeatured/"+this.belongTo+"/"+this.id,data:t,headers:e}).then((t=>{console.log(t),this.isFeatured=!this.isFeatured})).catch((t=>{console.log(t)}))},async pin(){var t=new FormData;t.append("feedId",this.id),t.append("groupId",this.belongTo);var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),await this.$axios({method:"put",url:"/api/v1/group/setPin/"+this.belongTo+"/"+this.id,data:t,headers:e}).then((t=>{console.log(t),this.isPin=!this.isPin})).catch((t=>{console.log(t)}))},async follow(){var t=new FormData;t.append("isFollowed",!this.isFollow),t.append("feedId",this.id);var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),await this.$axios({method:"put",url:"/api/v1/feed/react/"+this.id,data:t,headers:e}).then((t=>{console.log(t),this.isFollow=!this.isFollow})).catch((t=>{switch(console.log(t),t.response.status){case 401:this.$notify({title:"请先加入小组！",type:"warning",position:"top-left"});break;case 403:this.$notify({title:"请先登录！",type:"warning",position:"top-left"});break}}))},async like(){var t;t="L"==this.response?"O":"L";var e=new FormData;e.append("response",t),e.append("feedId",this.id);var i={};localStorage.getItem("token")&&(i={Authorization:"Bearer "+localStorage.getItem("token")}),await this.$axios({method:"put",url:"/api/v1/feed/react/"+this.id,data:e,headers:i}).then((e=>{console.log(e),this.response=t,"L"==this.response?this.likeCount++:this.likeCount--})).catch((t=>{switch(console.log(t),t.response.status){case 401:this.$notify({title:"请先加入小组！",type:"warning",position:"top-left"});break;case 403:this.$notify({title:"请先登录",type:"warning",position:"top-left"});break}}))},async commentResponse(t,e){var i=new FormData;i.append("response",e),i.append("reviewId",t.id);var s={};localStorage.getItem("token")&&(s={Authorization:"Bearer "+localStorage.getItem("token")}),await this.$axios({method:"put",url:"/api/v1/review/react/"+t.id,data:i,headers:s}).then((i=>{console.log(i),"O"==t.response?"L"==e?t.likes++:t.dislikes++:"L"==t.response?"O"==e?t.likes--:(t.likes--,t.dislikes++):("O"==e||t.likes++,t.dislikes--),t.response=e})).catch((t=>{switch(console.log(t),t.response.status){case 401:this.$notify({title:"请先加入小组！",type:"warning",position:"top-left"});break;case 403:this.$notify({title:"请先登录",type:"warning",position:"top-left"});break}}))},submitReview(t){t.preventDefault();let e=new FormData;e.append("description",this.userComment.content),e.append("img",this.userComment.img),e.append("feed",this.id),e.append("book",""),e.append("movie","");var i={};localStorage.getItem("token")&&(i={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"post",url:"/api/v1/review/",data:e,headers:i}).then((t=>{console.log(t),this.$notify({showClose:!0,message:"已发布评论",type:"success",position:"top-left"}),location.reload()})).catch((t=>{switch(console.log(t),t.response.status){case 400:this.userComment.content.length>5e3?this.$notify({title:"评论长度不可超过5000字符！",type:"warning",position:"top-left"}):this.$notify({title:"评论不能为空！",type:"warning",position:"top-left"});break;case 401:this.$notify({title:"请先加入小组！",type:"warning",position:"top-left"});break}}))},async getAll(){await this.$axios.all([this.getFeedDetail(),this.getComment()]).then(this.$axios.spread(((t,e)=>{var i=t.data;this.title=i.title,this.description=i.description,this.image=i.img,this.isPublic=i.isPublic,this.createdBy=i.createdBy,this.belongTo=i.belongTo,this.belongTag=i.belongTag,this.createdAt=new Date(i.createdAt).getTime(),this.likeCount=i.likes,this.commentCount=e.data.count,this.comments=e.data.results,this.response=i.response,this.isFollow=i.isFollow,this.isMine=i.createdBy==this.userId}))).catch((t=>{console.log(t)})),this.islogin&&await this.$axios.get("/api/v1/user/"+this.userId).then((t=>{this.user=t.data.username,this.userAvatar=t.data.profile})).catch((t=>{console.log(t)})),await this.$axios.get("/api/v1/user/"+this.createdBy).then((t=>{this.publisherName=t.data.username,t.data.profile&&(this.publisherAvatar=t.data.profile)})).catch((t=>{console.log(t)})),this.isPublic?await this.$axios.get("/api/v1/tag/"+this.belongTag).then((t=>{this.tagTitle=t.data.title})).catch((t=>{console.log(t)})):await this.$axios.get("/api/v1/group/"+this.belongTo).then((t=>{this.groupName=t.data.groupName})).catch((t=>{console.log(t)}));for(let t=0;t<this.comments.length;t++)this.comments[t].time=new Date(this.comments[t].createdAt).getTime(),await this.$axios.get("api/v1/review/"+this.comments[t].id).then((e=>{this.comments[t].img=e.data.img,this.comments[t].likes=e.data.likes,this.comments[t].dislikes=e.data.dislikes})).catch((t=>{console.log(t)})),await this.$axios.get("/api/v1/user/"+this.comments[t].createdBy).then((e=>{this.comments[t].publisherName=e.data.username,e.data.profile&&(this.comments[t].publisherAvatar=e.data.profile),t==this.comments.length-1&&(this.status=!0)})).catch((t=>{console.log(t)}))},getFeedDetail(){var t={};return localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/feed/"+this.id,headers:t})},getComment(){var t={};return localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/review/list?feed="+this.id,headers:t})},getUser(){return this.$axios({method:"get",url:"/api/v1/user/"+this.userId})},dateStr(t){var e,i=(new Date).getTime();if(i=parseInt((i-t)/1e3),i<600)return"刚刚";if(i<3600)return e=Math.floor(i/60),e+"分钟前";if(i<86400)return e=Math.floor(i/60/60),e+"小时前";if(i<432e3)return e=Math.floor(i/60/60/24),e+"天前";{t=new Date(parseInt(t));let e=t.getFullYear(),i=t.getMonth()<10?"0"+(t.getMonth()+1):t.getMonth()+1,s=t.getDate()<10?"0"+t.getDate():t.getDate(),a=t.getHours()<10?"0"+t.getHours():t.getHours(),o=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes();return e+"-"+i+"-"+s+" "+a+":"+o}},descriptionCalc(){if(this.isShowComment)return this.description.replace(/(\r\n|\n|\r)/gm,"<br/>");var t="";return t=!1===this.isExpand?this.description.substring(0,180)+"...":this.description,t.replace(/(\r\n|\n|\r)/gm,"<br/>")},changeExpand(){this.isExpand=!this.isExpand},getImg(t){var e=t.target.files[0].name;$(".showFileName").html(e),this.userComment.img=t.target.files[0]},deleteImg(){$("#imgUpload").attr("type","text"),$("#imgUpload").attr("type","file"),$(".showFileName").html(""),this.userComment.img=""},contentCalc(t){return t.replace(/(\r\n|\n|\r)/gm,"<br/>")},report(t){this.$router.push({path:`/report/${t}`})},enterProfile(t){this.$router.push({path:`/profile/${t}`})},enterGroup(t){this.$router.push({path:`/group/${t}`})},enterTag(t){this.$router.push({path:`/tag/${t}`})},enterFeed(){this.$router.push({path:`/feed/${this.id}`})}}},r=n,l=i(1001),c=(0,l.Z)(r,s,a,!1,null,"19ad771c",null),p=c.exports},7970:function(t,e,i){t.exports=i.p+"img/Love.993dd4f0.svg"},392:function(t,e,i){t.exports=i.p+"img/Love_fill.98443daf.svg"}}]);
//# sourceMappingURL=95.c84895ed.js.map