"use strict";(self["webpackChunkse_project"]=self["webpackChunkse_project"]||[]).push([[425],{44501:function(t,e,o){o.r(e),o.d(e,{default:function(){return u}});var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"all"},[o("Header",{attrs:{id:"header"}}),o("div",{style:{"min-height":t.mainMinHeight+"px"},attrs:{id:"main"}},[o("el-row",[o("span",{staticClass:"tag-title"},[t._v("#"+t._s(t.tagTitle)+"#")]),o("el-row",{staticClass:"action"},[o("span",{on:{click:function(e){return t.openForm()}}},[t._v(" 发布帖子 ")]),o("el-divider",{attrs:{direction:"vertical"}}),t.isJoined?o("span",{on:{click:function(e){return t.unjoinTag()}}},[t._v(" 退出话题 ")]):o("span",{on:{click:function(e){return t.joinTag()}}},[t._v(" 参与话题 ")]),o("el-dialog",{attrs:{title:"发布帖子",visible:t.formVisible},on:{"update:visible":function(e){t.formVisible=e}}},[o("el-form",{attrs:{"label-position":"top",model:t.form}},[o("el-form-item",{attrs:{label:"标题","label-width":t.formLabelWidth}},[o("el-input",{attrs:{autocomplete:"off",maxlength:"25","show-word-limit":""},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),o("el-form-item",{attrs:{label:"内容","label-width":t.formLabelWidth}},[o("el-input",{attrs:{type:"textarea",autosize:"",autocomplete:"off",minlength:"25","show-word-limit":"",resize:"none"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}}),o("el-upload",{attrs:{action:"","auto-upload":!1,"on-change":t.handleChange,"before-remove":t.beforeRemove,limit:1,accept:"image/jpeg,image/gif,image/png,image/jpg","on-exceed":t.handleExceed}},[o("el-button",{staticClass:"form-upload-img",attrs:{size:"small",type:"primary"}},[o("i",{staticClass:"el-icon-picture-outline-round"}),t._v(" 上传图片 ")])],1)],1)],1),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{staticClass:"button-no",on:{click:function(e){t.formVisible=!1}}},[t._v("取 消")]),o("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"button-yes",on:{click:function(e){return t.postFeed()}}},[t._v("发布")])],1)],1)],1)],1),t._l(t.notGroupFeeds,(function(t){return o("FeedBox",{key:t.id,attrs:{initialFeedId:t.id,initialIsInnerpage:!1,initialIsPin:!1,initialIsFeatured:!1,initialIsAdmin:!1}})}))],2),o("Footer",{attrs:{id:"footer"}}),o("el-backtop",{attrs:{target:".all"}},[o("i",{staticClass:"el-icon-arrow-up",staticStyle:{color:"#456268"}})])],1)},n=[],s=(o(57327),o(41539),o(92222),o(68309),o(82526),o(41817),o(13083)),a=o(43445),l=o(75095),r=o(22282),c={name:"TagInnerpage",components:{Header:s.Z,Footer:a.Z,FeedBox:l.Z},data:function(){return{islogin:!1,fullscreenLoading:!1,count:0,user:"栀子花开",id:"",tagTitle:"",isJoined:!1,formVisible:!1,formLabelWidth:"120px",form:{title:"",description:"",img:""},dataList:"",feeds:[],mainMinHeight:""}},mounted:function(){var t;(t=r.Z.getters.getUser(r.Z.state()))&&(this.islogin=!0,this.userId=t.user.id),this.getTag(),this.getFeed(),this.mainMinHeight=document.documentElement.clientHeight-$("#header").outerHeight(!0)-$("#footer").outerHeight(!0)-6},computed:{notGroupFeeds:function(){return this.feeds.filter((function(t){return t.isPublic}))}},methods:{handleChange:function(t,e){this.form.img=t.raw,console.log(this.form.img)},handleExceed:function(t,e){this.$message.warning("当前限制选择 1 个文件，本次选择了 ".concat(t.length," 个文件，共选择了 ").concat(t.length+e.length," 个文件"))},beforeRemove:function(t,e){return this.$confirm("确定移除 ".concat(t.name,"？"))},openForm:function(){this.islogin?this.isJoined?this.formVisible=!0:this.$notify({showClose:!0,type:"warning",title:"请先参与话题",position:"top-left"}):this.$notify({showClose:!0,type:"warning",title:"请先登录",position:"top-left"})},postFeed:function(){var t=this;if(this.islogin)if(this.form.title)if(this.form.description.length<25)this.$notify({showClose:!0,type:"warning",title:"话题内容不能少于25字",position:"top-left"});else{this.fullscreenLoading=!0;var e=new FormData;e.append("title",this.form.title),e.append("description",this.form.description),e.append("img",this.form.img),e.append("belongTag",this.id);var o={};localStorage.getItem("token")&&(o={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"post",url:"/api/v1/feed/",data:e,headers:o}).then((function(e){switch(console.log(e),t.formVisible=!1,t.fullscreenLoading=!1,e.status){case 201:t.$notify({showClose:!0,message:"已发表帖子",type:"success",position:"top-left"}),setTimeout((function(){location.reload()}),1500);break}})).catch((function(e){switch(console.log(e),e.response.status){case 400:t.$notify({title:"标题和内容不能为空！",type:"warning",position:"top-left"});break;case 401:t.$notify({title:"请先加入小组！",type:"warning",position:"top-left"});break}}))}else this.$notify({showClose:!0,type:"warning",title:"标题不能为空",position:"top-left"});else this.$notify({showClose:!0,type:"warning",title:"请先登录",position:"top-left"})},unjoinTag:function(){var t=this,e=new FormData;e.append("tagId",this.id);var o={};localStorage.getItem("token")&&(o={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"delete",url:"/api/v1/tag/unjoin/"+this.id,data:e,headers:o}).then((function(e){switch(console.log(e),e.status){case 200:t.$notify({showClose:!0,message:"已退出话题",type:"success",position:"top-left"}),t.isJoined=!1;break}})).catch((function(t){console.log(t)}))},joinTag:function(){var t=this,e=new FormData;e.append("user",this.userId),e.append("tag",this.id);var o={};localStorage.getItem("token")&&(o={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"post",url:"/api/v1/tag/join/",data:e,headers:o}).then((function(e){switch(console.log(e),e.status){case 201:t.$notify({showClose:!0,message:"已参与话题",type:"success",position:"top-left"}),t.isJoined=!0}})).catch((function(e){switch(console.log(e),e.response.status){case 403:t.$notify({title:"请先登录",type:"warning",position:"top-left"});break}}))},getTag:function(){var t=this;this.id=this.$route.params.id;var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/tag/"+this.$route.params.id,headers:e}).then((function(e){console.log(e),t.tagTitle=e.data.title,t.isJoined=e.data.isJoined})).catch((function(t){console.log(t)}))},getFeed:function(){var t=this,e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),console.log(e),this.$axios({method:"get",url:"/api/v1/feed/list?tag="+this.$route.params.id,headers:e}).then((function(e){console.log(e),t.feeds=e.data.results,console.log(t.feeds)})).catch((function(t){console.log(t)}))},getImg:function(t){console.log("!!!!!"),console.log(document.querySelector("#imgUpload").files[0]);var e=t.target.files[0].name;$(".showFileName").html(e),console.log(e),this.form.img=t.target.files[0],console.log("get img! ",this.form)}}},g=c,d=o(1001),f=(0,d.Z)(g,i,n,!1,null,"73543b67",null),u=f.exports}}]);
//# sourceMappingURL=425-legacy.557411d7.js.map