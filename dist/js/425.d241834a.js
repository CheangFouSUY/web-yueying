"use strict";(self["webpackChunkse_project"]=self["webpackChunkse_project"]||[]).push([[425],{4501:function(t,e,i){i.r(e),i.d(e,{default:function(){return m}});var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"all"},[i("Header",{attrs:{id:"header"}}),i("div",{style:{"min-height":t.mainMinHeight+"px"},attrs:{id:"main"}},[i("el-row",[i("span",{staticClass:"tag-title"},[t._v("#"+t._s(t.tagTitle)+"#")]),i("el-row",{staticClass:"action"},[i("span",{on:{click:function(e){return t.openForm()}}},[t._v(" 发布帖子 ")]),i("el-divider",{attrs:{direction:"vertical"}}),t.isJoined?i("span",{on:{click:function(e){return t.unjoinTag()}}},[t._v(" 退出话题 ")]):i("span",{on:{click:function(e){return t.joinTag()}}},[t._v(" 参与话题 ")]),i("el-dialog",{attrs:{title:"发布帖子",visible:t.formVisible},on:{"update:visible":function(e){t.formVisible=e}}},[i("el-form",{attrs:{"label-position":"top",model:t.form}},[i("el-form-item",{attrs:{label:"标题","label-width":t.formLabelWidth}},[i("el-input",{attrs:{autocomplete:"off",maxlength:"25","show-word-limit":""},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),i("el-form-item",{attrs:{label:"内容","label-width":t.formLabelWidth}},[i("el-input",{attrs:{type:"textarea",autosize:"",autocomplete:"off",minlength:"25","show-word-limit":"",resize:"none"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}}),i("el-upload",{attrs:{action:"","auto-upload":!1,"on-change":t.handleChange,"before-remove":t.beforeRemove,limit:1,accept:"image/jpeg,image/gif,image/png,image/jpg","on-exceed":t.handleExceed}},[i("el-button",{staticClass:"form-upload-img",attrs:{size:"small",type:"primary"}},[i("i",{staticClass:"el-icon-picture-outline-round"}),t._v(" 上传图片 ")])],1)],1)],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{staticClass:"button-no",on:{click:function(e){t.formVisible=!1}}},[t._v("取 消")]),i("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"button-yes",on:{click:function(e){return t.postFeed()}}},[t._v("发布")])],1)],1)],1)],1),t._l(t.notGroupFeeds,(function(t){return i("FeedBox",{key:t.id,attrs:{initialFeedId:t.id,initialIsInnerpage:!1,initialIsPin:!1,initialIsFeatured:!1,initialIsAdmin:!1}})}))],2),i("Footer",{attrs:{id:"footer"}}),i("el-backtop",{attrs:{target:".all"}},[i("i",{staticClass:"el-icon-arrow-up",staticStyle:{color:"#456268"}})])],1)},s=[],a=i(3083),n=i(3445),l=i(5095),r=i(2282),c={name:"TagInnerpage",components:{Header:a.Z,Footer:n.Z,FeedBox:l.Z},data(){return{islogin:!1,fullscreenLoading:!1,count:0,user:"栀子花开",id:"",tagTitle:"",isJoined:!1,formVisible:!1,formLabelWidth:"120px",form:{title:"",description:"",img:""},dataList:"",feeds:[],mainMinHeight:""}},mounted(){var t;(t=r.Z.getters.getUser(r.Z.state()))&&(this.islogin=!0,this.userId=t.user.id),this.getTag(),this.getFeed(),this.mainMinHeight=document.documentElement.clientHeight-$("#header").outerHeight(!0)-$("#footer").outerHeight(!0)-6},computed:{notGroupFeeds(){return this.feeds.filter((t=>t.isPublic))}},methods:{handleChange(t,e){this.form.img=t.raw,console.log(this.form.img)},handleExceed(t,e){this.$message.warning(`当前限制选择 1 个文件，本次选择了 ${t.length} 个文件，共选择了 ${t.length+e.length} 个文件`)},beforeRemove(t,e){return this.$confirm(`确定移除 ${t.name}？`)},openForm(){this.islogin?this.isJoined?this.formVisible=!0:this.$notify({showClose:!0,type:"warning",title:"请先参与话题",position:"top-left"}):this.$notify({showClose:!0,type:"warning",title:"请先登录",position:"top-left"})},postFeed(){if(!this.islogin)return void this.$notify({showClose:!0,type:"warning",title:"请先登录",position:"top-left"});if(!this.form.title)return void this.$notify({showClose:!0,type:"warning",title:"标题不能为空",position:"top-left"});if(this.form.description.length<25)return void this.$notify({showClose:!0,type:"warning",title:"话题内容不能少于25字",position:"top-left"});this.fullscreenLoading=!0;let t=new FormData;t.append("title",this.form.title),t.append("description",this.form.description),t.append("img",this.form.img),t.append("belongTag",this.id);var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"post",url:"/api/v1/feed/",data:t,headers:e}).then((t=>{switch(console.log(t),this.formVisible=!1,this.fullscreenLoading=!1,t.status){case 201:this.$notify({showClose:!0,message:"已发表帖子",type:"success",position:"top-left"}),setTimeout((function(){location.reload()}),1500);break}})).catch((t=>{switch(console.log(t),t.response.status){case 400:this.$notify({title:"标题和内容不能为空！",type:"warning",position:"top-left"});break;case 401:this.$notify({title:"请先加入小组！",type:"warning",position:"top-left"});break}}))},unjoinTag(){let t=new FormData;t.append("tagId",this.id);var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"delete",url:"/api/v1/tag/unjoin/"+this.id,data:t,headers:e}).then((t=>{switch(console.log(t),t.status){case 200:this.$notify({showClose:!0,message:"已退出话题",type:"success",position:"top-left"}),this.isJoined=!1;break}})).catch((t=>{console.log(t)}))},joinTag(){let t=new FormData;t.append("user",this.userId),t.append("tag",this.id);var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"post",url:"/api/v1/tag/join/",data:t,headers:e}).then((t=>{switch(console.log(t),t.status){case 201:this.$notify({showClose:!0,message:"已参与话题",type:"success",position:"top-left"}),this.isJoined=!0}})).catch((t=>{switch(console.log(t),t.response.status){case 403:this.$notify({title:"请先登录",type:"warning",position:"top-left"});break}}))},getTag(){this.id=this.$route.params.id;var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/tag/"+this.$route.params.id,headers:t}).then((t=>{console.log(t),this.tagTitle=t.data.title,this.isJoined=t.data.isJoined})).catch((t=>{console.log(t)}))},getFeed(){var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),console.log(t),this.$axios({method:"get",url:"/api/v1/feed/list?tag="+this.$route.params.id,headers:t}).then((t=>{console.log(t),this.feeds=t.data.results,console.log(this.feeds)})).catch((t=>{console.log(t)}))},getImg(t){console.log("!!!!!"),console.log(document.querySelector("#imgUpload").files[0]);var e=t.target.files[0].name;$(".showFileName").html(e),console.log(e),this.form.img=t.target.files[0],console.log("get img! ",this.form)}}},d=c,g=i(1001),h=(0,g.Z)(d,o,s,!1,null,"73543b67",null),m=h.exports}}]);
//# sourceMappingURL=425.d241834a.js.map