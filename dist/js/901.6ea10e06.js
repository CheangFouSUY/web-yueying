"use strict";(self["webpackChunkse_project"]=self["webpackChunkse_project"]||[]).push([[901],{2584:function(e,t,a){a.r(t),a.d(t,{default:function(){return c}});var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"Profile"},[a("Header",{attrs:{id:"header",initialUsername:e.form.name}}),a("div",{style:{"min-height":e.mainMinHeight+"px"},attrs:{id:"main"}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("div",{staticClass:"profile-box"},[a("el-row",[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"profile-content"},[a("div",{staticClass:"profilePic"},[e.isOwnProfile?a("el-upload",{attrs:{id:"avatar-uploader",action:"","http-request":e.uploadAvatar,"show-file-list":!1,accept:"image/jpeg,image/gif,image/png,image/jpg"}},[e.form.imageUrl?a("el-avatar",{attrs:{shape:"square",size:256,src:e.form.imageUrl}}):a("el-avatar",{attrs:{shape:"square",size:256,icon:"el-icon-user-solid"}}),a("div",{attrs:{id:"change-pic"}},[e._v("更换头像")])],1):a("div",[e.form.imageUrl?a("el-avatar",{attrs:{shape:"square",size:256,src:e.form.imageUrl}}):a("el-avatar",{attrs:{shape:"square",size:256,icon:"el-icon-user-solid"}})],1)],1)])]),a("el-col",{attrs:{span:15}},[a("div",{staticClass:"profile-content"},[a("el-row",[a("el-col",{attrs:{span:20}},[a("div",{staticClass:"profile-info"},[a("span",{staticClass:"profile-text1"},[e._v("名字 :")]),e.form.isEdit?a("el-input",{attrs:{placeholder:"请输入新昵称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}}):a("span",{staticClass:"profile-text2"},[e._v(" "+e._s(e.form.name))])],1)])],1),a("el-row",[a("el-col",{attrs:{span:20}},[a("div",{staticClass:"profile-info"},[a("span",{staticClass:"profile-text1"},[e._v("性别 :")]),a("span",{staticClass:"profile-text2"},[e._v(" "+e._s(e.form.sexWord))])])])],1),a("el-row",[a("el-col",{attrs:{span:20}},[a("div",{staticClass:"profile-info"},[a("span",{staticClass:"profile-text1"},[e._v("生日 :")]),a("span",{staticClass:"profile-text2"},[e._v(" "+e._s(e.form.dob))])])])],1),a("el-row",[a("el-col",{attrs:{span:20}},[a("div",{staticClass:"profile-info"},[a("span",{staticClass:"profile-text1"},[e._v("邮箱 :")]),a("span",{staticClass:"profile-text2"},[e._v(" "+e._s(e.form.email))])])])],1),a("el-row",[a("el-col",{attrs:{span:20}},[a("div",{staticClass:"profile-info"},[a("span",{staticClass:"profile-text1"},[e._v("自我介绍 :")]),a("span",{staticClass:"profile-text2"},[e._v(" "+e._s(e.form.about))])])])],1)],1)]),a("el-dialog",{attrs:{title:"编辑个人信息",visible:e.changeVisible,"close-on-click-modal":!1,"show-close":!1},on:{"update:visible":function(t){e.changeVisible=t}}},[a("el-form",{attrs:{"label-position":"top",model:e.form}},[a("el-form-item",{attrs:{label:"名字","label-width":e.formLabelWidth}},[a("el-input",{attrs:{autocomplete:"off",maxlength:"10","show-word-limit":""},model:{value:e.form.nameTemp,callback:function(t){e.$set(e.form,"nameTemp",t)},expression:"form.nameTemp"}})],1),a("el-form-item",{attrs:{label:"性别"}},[a("el-radio-group",{model:{value:e.form.sexTemp,callback:function(t){e.$set(e.form,"sexTemp",t)},expression:"form.sexTemp"}},[a("el-radio",{attrs:{label:"M"}},[e._v("男")]),a("el-radio",{attrs:{label:"F"}},[e._v("女")]),a("el-radio",{attrs:{label:"O"}},[e._v("其他")])],1)],1),a("el-form-item",{attrs:{label:"生日"}},[a("el-col",{attrs:{span:11}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择你的生日日期","value-format":"yyyy-MM-dd"},model:{value:e.form.dobTemp,callback:function(t){e.$set(e.form,"dobTemp",t)},expression:"form.dobTemp"}})],1)],1),a("el-form-item",{attrs:{label:"自我介绍","label-width":e.formLabelWidth}},[a("el-input",{attrs:{type:"textarea",autosize:"",autocomplete:"off","show-word-limit":"",resize:"none"},model:{value:e.form.aboutTemp,callback:function(t){e.$set(e.form,"aboutTemp",t)},expression:"form.aboutTemp"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.cancelChanges}},[e._v("取消")]),a("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"primary"},on:{click:e.updateProfileInfo}},[e._v("完成编辑")])],1)],1),a("el-col",{attrs:{span:3}},[a("div",{staticClass:"profile-content"},[e.isOwnProfile?a("el-button",{staticClass:"Edit",on:{click:function(t){e.changeVisible=!0}}},[e._v("编辑资料")]):e._e()],1)])],1)],1)])],1),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},e._l(e.feeds,(function(e){return a("FeedBox",{key:e.id,attrs:{initialFeedId:e.id,initialIsGroup:!1,initialIsPin:!1,initialIsFeatured:!1,initialIsAdmin:!1}})})),1)],1)],1),a("Footer",{attrs:{id:"footer"}}),a("el-backtop",{attrs:{target:".Profile"}},[a("i",{staticClass:"el-icon-arrow-up",staticStyle:{color:"#456268"}})])],1)},s=[],i=a(3083),r=a(3445),l=a(5095),n=a(2282),m={name:"Profile",components:{Header:i.Z,Footer:r.Z,FeedBox:l.Z},watch:{$route:{handler:"profileReload"}},data(){return{userId:"123456",isOwnProfile:!1,fullscreenLoading:!1,form:{imageUrl:"",isEdit:!1,id:"",name:"",nameTemp:"",sexWord:"",sex:"",sexTemp:"",dob:"",dobTemp:"",email:"",about:"",aboutTemp:""},changeVisible:!1,formLabelWidth:"120px",feeds:[],mainMinHeight:""}},created(){var e;(e=n.Z.getters.getUser(n.Z.state()))&&(this.userId=e.user.id,this.userId==this.$route.params.id&&(this.isOwnProfile=!0)),this.getProfile(),this.getFeed()},mounted(){this.mainMinHeight=document.documentElement.clientHeight-$("#header").outerHeight(!0)-$("#footer").outerHeight(!0)-6},methods:{profileReload(){location.reload()},async uploadAvatar(e){const t=new FormData;t.append("email",this.form.email),t.append("username",this.form.name),t.append("profile",e.file),t.append("userId",this.form.id),console.log(e.file);var a={};localStorage.getItem("token")&&(a={Authorization:"Bearer "+localStorage.getItem("token")}),await this.$axios({method:"put",url:"/api/v1/user/"+this.$route.params.id,data:t,headers:a}).then((e=>{console.log(e),this.form.imageUrl=e.data.profile,location.reload()})).catch((e=>{console.log(e)}))},async getFeed(){var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),await this.$axios({method:"get",url:"/api/v1/feed/list?createdBy="+this.$route.params.id,headers:e}).then((e=>{this.feeds=e.data.results,console.log(this.feeds)})).catch((e=>{console.log(e)}))},async getProfile(){console.log(this.$route.params.id),await this.$axios({method:"get",url:"/api/v1/user/"+this.$route.params.id}).then((e=>{var t=e.data;console.log(t),this.form.id=t.id,this.form.name=t.username,this.form.nameTemp=t.username,this.form.sex=t.gender,this.form.sexTemp=t.gender,console.log(this.form.sexTemp),this.form.dob=t.dob,this.form.dobTemp=t.dob,this.form.email=t.email,this.form.about=t.about,this.form.aboutTemp=t.about,t.profile&&(this.form.imageUrl=t.profile),"M"==this.form.sex&&(this.form.sexWord="男"),"F"==this.form.sex&&(this.form.sexWord="女"),"O"==this.form.sex&&(this.form.sexWord="其他")})).catch((e=>{this.$message.warning(e)}))},cancelChanges(){this.changeVisible=!1,this.form.nameTemp=this.form.name,this.form.aboutTemp=this.form.about,this.form.sexTemp=this.form.sex,this.form.dobTemp=this.form.dob},async updateProfileInfo(){this.fullscreenLoading=!0;const e=new FormData;e.append("email",this.form.email),e.append("username",this.form.nameTemp),e.append("userId",this.form.id),e.append("about",this.form.aboutTemp),e.append("gender",this.form.sexTemp),e.append("dob",this.form.dobTemp);var t={};localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),await this.$axios({method:"put",url:"/api/v1/user/"+this.$route.params.id,data:e,headers:t}).then((e=>{console.log(e),this.form.name=this.form.nameTemp,this.form.about=this.form.aboutTemp,this.form.dob=this.form.dobTemp,this.form.sex=this.form.sexTemp,"M"==this.form.sex&&(this.form.sexWord="男"),"F"==this.form.sex&&(this.form.sexWord="女"),"O"==this.form.sex&&(this.form.sexWord="其他"),this.changeVisible=!1,this.fullscreenLoading=!1,setTimeout((function(){location.reload(!0)}),500),this.$message.success("恭喜！修改成功")})).catch((e=>{console.log(e),this.$message.warning("抱歉！用户名已被使用")}))}}},f=m,d=a(1001),p=(0,d.Z)(f,o,s,!1,null,"fdb73b6e",null),c=p.exports}}]);
//# sourceMappingURL=901.6ea10e06.js.map