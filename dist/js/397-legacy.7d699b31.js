"use strict";(self["webpackChunkse_project"]=self["webpackChunkse_project"]||[]).push([[397],{96397:function(t,e,o){o.r(e),o.d(e,{default:function(){return g}});var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("Header",{attrs:{id:"header"}}),s("div",{style:{"min-height":t.mainMinHeight+"px"},attrs:{id:"main"}},[s("div",{staticClass:"book-wrap"},[s("el-row",{attrs:{gutter:30}},[s("el-col",{attrs:{span:6}},[s("el-image",{staticClass:"poster",attrs:{src:t.src}})],1),s("el-col",{attrs:{span:14}},[s("el-row",{attrs:{id:"book-title"}},[t._v(t._s(t.title))]),s("el-row",{staticClass:"book-detail"},[s("div",{staticClass:"book-detail-prop"},[t._v("作者")]),s("div",{staticClass:"symbol"},[t._v("：")]),t._v(" "+t._s(t.author)+" ")]),s("el-row",{staticClass:"book-detail"},[s("div",{staticClass:"book-detail-prop"},[t._v("类型")]),s("div",{staticClass:"symbol"},[t._v("：")]),t._v(" "+t._s(t.category)+" ")]),s("el-row",{staticClass:"book-detail"},[s("div",{staticClass:"book-detail-prop"},[t._v("年份")]),s("div",{staticClass:"symbol"},[t._v("：")]),t._v(" "+t._s(t.year)+" ")]),s("el-row",{staticClass:"book-detail"},[s("div",{staticClass:"book-detail-prop"},[t._v("出版社")]),s("div",{staticClass:"symbol"},[t._v("：")]),t._v(" "+t._s(t.publish)+" ")])],1),s("el-col",{attrs:{span:4}},[!1===t.isBookmark?s("img",{staticClass:"bookmark",attrs:{src:o(75131),alt:"bookmark"},on:{click:function(e){return t.bookmark()}}}):s("img",{staticClass:"bookmark",attrs:{src:o(70906),alt:"bookmark"},on:{click:function(e){return t.bookmark()}}}),s("el-row",{staticClass:"rate-box",attrs:{type:"flex",justify:"center"}},[s("el-col",{attrs:{id:"rating",span:10}},[t._v(t._s(t.rating))]),s("el-col",{attrs:{span:8,offset:0}},[s("img",{staticClass:"rating-icon",attrs:{src:o(94094),alt:""}})])],1),s("el-rate",{attrs:{colors:t.rateColors},on:{change:function(e){return t.selectRate(t.rateValue)}},model:{value:t.rateValue,callback:function(e){t.rateValue=e},expression:"rateValue"}})],1),s("el-row",{staticClass:"book-detail",attrs:{gutter:30}},[s("el-col",{attrs:{span:17}},[s("div",{staticClass:"book-detail-prop"},[t._v("简介")]),s("div",{staticClass:"symbol"},[t._v("：")]),s("span",[t._v(" ")]),s("span",{staticStyle:{"word-wrap":"break-word"},domProps:{innerHTML:t._s(t.contentCalc(t.description))}})])],1)],1),s("el-row",{staticClass:"like-comment-wrap"},["L"===t.response?s("img",{attrs:{src:o(392),alt:"love"},on:{click:function(e){return t.like()}}}):s("img",{attrs:{src:o(87970),alt:"love"},on:{click:function(e){return t.like()}}}),s("span",{staticClass:"like-count"},[t._v(t._s(t.likeCount))]),s("img",{attrs:{src:o(82392),alt:"comment"}}),s("span",{staticClass:"comment-count"},[t._v(t._s(t.commentCount))])])],1),s("div",{staticClass:"comment-wrap"},[s("el-row",{staticClass:"comment-header"},[t._v("书评")]),s("el-divider"),t.islogin?s("el-row",{staticClass:"publish-box"},[s("el-row",{attrs:{gutter:70}},[s("el-col",{attrs:{span:1}},[t.userAvatar?s("el-avatar",{attrs:{size:50,src:t.userAvatar}}):s("el-avatar",{attrs:{size:50,icon:"el-icon-user-solid"}})],1),s("el-col",{attrs:{span:22}},[s("el-row",{staticClass:"comment-publisher"},[t._v(t._s(t.user))]),s("el-row",{staticClass:"publish-write"},[s("form",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.userComment.title,expression:"userComment.title"}],attrs:{type:"text",placeholder:"书评标题："},domProps:{value:t.userComment.title},on:{input:function(e){e.target.composing||t.$set(t.userComment,"title",e.target.value)}}}),s("div",{staticClass:"comment-autosize-wrapper"},[s("pre",{staticClass:"comment-autosize"},[t._v("                    "),s("br"),t._v(t._s(t.userComment.content)+"\n                  ")]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.userComment.content,expression:"userComment.content"}],attrs:{placeholder:"书评内容："},domProps:{value:t.userComment.content},on:{input:function(e){e.target.composing||t.$set(t.userComment,"content",e.target.value)}}})]),s("span",{staticClass:"showFileName"}),t.userComment.img?s("i",{staticClass:"el-icon-delete",staticStyle:{cursor:"pointer"},on:{click:function(e){return t.deleteImg()}}}):t._e(),s("input",{attrs:{id:"imgUpload",type:"file",accept:"image/png,image/gif,image/jpeg"},on:{change:function(e){return t.getImg(e)}}}),s("el-row",{staticClass:"publish-action",attrs:{span:20}},[s("i",{staticClass:"el-icon-picture-outline-round",attrs:{onclick:"$('input[id=imgUpload]').click();"}}),s("i",{staticClass:"el-icon-position",attrs:{id:"imgIcon"},on:{click:function(e){return t.submitReview(e)}}})])],1)])],1)],1)],1):t._e(),t._l(t.comments,(function(e){return s("el-row",{key:e.id,staticClass:"comment-box"},[s("el-divider"),s("el-row",{attrs:{gutter:70}},[s("el-col",{attrs:{span:1}},[e.publisherAvatar?s("el-avatar",{attrs:{size:50,src:e.publisherAvatar}}):s("el-avatar",{attrs:{size:50,icon:"el-icon-user-solid"}})],1),s("el-col",{attrs:{span:22}},[t.status?s("el-row",{staticClass:"comment-publisher"},[s("span",{staticStyle:{cursor:"pointer"},on:{click:function(o){return t.enterProfile(e.createdBy)}}},[t._v(" "+t._s(e.publisherName)+" ")])]):t._e(),t.status?s("el-row",{staticClass:"comment-time"},[s("i",{staticClass:"el-icon-time"}),t._v(" "+t._s(t.dateStr(e.time))+" ")]):t._e(),s("el-row",{staticClass:"comment-title"},[t._v(t._s(e.title))]),s("el-row",{staticClass:"comment-content",domProps:{innerHTML:t._s(t.contentCalc(e.description))}}),e.img?s("el-image",{staticClass:"comment-image",attrs:{src:e.img}}):t._e()],1)],1),s("el-row",{staticClass:"comment-action"},[s("el-col",{attrs:{span:3,offset:5}},[s("el-row",{attrs:{type:"flex",justify:"center"}},["L"===e.response?s("img",{attrs:{src:o(89337),alt:"happy icon"},on:{click:function(o){return t.commentResponse(e,"O")}}}):s("img",{attrs:{src:o(11816),alt:"happy icon"},on:{click:function(o){return t.commentResponse(e,"L")}}})]),s("el-row",{staticClass:"comment-like-count",attrs:{type:"flex",justify:"center"}},[t._v(" "+t._s(e.likes)+" ")])],1),s("el-col",{attrs:{span:3,offset:1}},[s("el-row",{attrs:{type:"flex",justify:"center"}},["D"===e.response?s("img",{attrs:{src:o(24714),alt:"sad icon"},on:{click:function(o){return t.commentResponse(e,"O")}}}):s("img",{attrs:{src:o(95414),alt:"sad icon"},on:{click:function(o){return t.commentResponse(e,"D")}}})]),s("el-row",{staticClass:"comment-like-count",attrs:{type:"flex",justify:"center"}},[t._v(" "+t._s(e.dislikes)+" ")])],1),s("el-col",{attrs:{span:3,offset:1}},[s("el-row",{attrs:{type:"flex",justify:"center"}},[s("img",{attrs:{id:"report",src:o(40506),alt:"report icon"},on:{click:function(o){return t.report("r&"+e.id)}}})])],1)],1)],1)}))],2)]),s("Footer",{attrs:{id:"footer"}})],1)},a=[],r=o(16198),n=(o(41539),o(39714),o(82526),o(41817),o(56977),o(78783),o(33948),o(74916),o(15306),o(68309),o(78975),o(13083)),i=o(43445),l=o(22282),c={name:"BookInnerpage",components:{Header:n.Z,Footer:i.Z},data:function(){return{status:!1,islogin:!1,user:"",userId:"",userAvatar:"",id:"",title:"",isbn:"",author:"",category:"",year:"",publish:"",description:"",src:"",rating:0,likeCount:0,commentCount:0,response:"O",isBookmark:!1,userComment:{title:"",content:"",img:""},isRate:!1,rateValue:-1,rateColors:["#99A9BF","#F7BA2A","#FF9900"],comments:[],categoryList:["其他","爱情","恐怖","悬疑","科幻","艺术","体育","烹饪","漫画","教育","哲学","文学"],mainMinHeight:""}},mounted:function(){var t;(t=l.Z.getters.getUser(l.Z.state()))&&(this.islogin=!0,this.userId=t.user.id),this.getAll(),this.mainMinHeight=document.documentElement.clientHeight-$("#header").outerHeight(!0)-$("#footer").outerHeight(!0)-6},watch:{$route:{handler:"bookReload"}},methods:{commentResponse:function(t,e){var o=this;return(0,r.Z)(regeneratorRuntime.mark((function s(){var a,r;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return a=new FormData,a.append("response",e),a.append("reviewId",t.id),r={},localStorage.getItem("token")&&(r={Authorization:"Bearer "+localStorage.getItem("token")}),console.log(r),s.next=8,o.$axios({method:"put",url:"/api/v1/review/react/"+t.id,data:a,headers:r}).then((function(o){console.log(o),"O"==t.response?"L"==e?t.likes++:t.dislikes++:"L"==t.response?"O"==e?t.likes--:(t.likes--,t.dislikes++):("O"==e||t.likes++,t.dislikes--),t.response=e})).catch((function(t){switch(console.log(t),t.response.status){case 403:o.$notify({title:"请先登录",type:"warning",position:"top-left"});break}}));case 8:case"end":return s.stop()}}),s)})))()},submitReview:function(t){var e=this;t.preventDefault();var o=new FormData;o.append("title",this.userComment.title),o.append("description",this.userComment.content),o.append("img",this.userComment.img),o.append("feed",""),o.append("book",this.id),o.append("movie","");var s={};localStorage.getItem("token")&&(s={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"post",url:"/api/v1/review/",data:o,headers:s}).then((function(t){switch(console.log(t),t.status){case 201:e.$notify({showClose:!0,message:"已发布评论",type:"success",position:"top-left"}),setTimeout((function(){location.reload()}),1500);break}})).catch((function(t){switch(console.log(t),t.response.status){case 400:e.userComment.title.length>150?e.$notify({title:"标题长度不可超过150字符！",type:"warning",position:"top-left"}):e.userComment.content.length>5e3?e.$notify({title:"内容长度不可超过5000字符！",type:"warning",position:"top-left"}):e.$notify({title:"标题和内容不能为空！",type:"warning",position:"top-left"});break}}))},like:function(){var t=this;return(0,r.Z)(regeneratorRuntime.mark((function e(){var o,s,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o="L"==t.response?"O":"L",s=new FormData,s.append("response",o),s.append("bookId",t.id),s.append("rateScore",t.rateValue),a={},localStorage.getItem("token")&&(a={Authorization:"Bearer "+localStorage.getItem("token")}),console.log(localStorage.getItem("token")),console.log(a),e.next=11,t.$axios({method:"put",url:"/api/v1/book/react/"+t.id,data:s,headers:a}).then((function(e){console.log(e),t.response=o,"L"==t.response?t.likeCount++:t.likeCount--})).catch((function(e){switch(console.log(e),e.response.status){case 403:t.$notify({title:"请先登录",type:"warning",position:"top-left"});break}}));case 11:case"end":return e.stop()}}),e)})))()},bookmark:function(){var t=this;return(0,r.Z)(regeneratorRuntime.mark((function e(){var o,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o=new FormData,o.append("isSaved",!t.isBookmark),o.append("bookId",t.id),o.append("rateScore",t.rateValue),s={},localStorage.getItem("token")&&(s={Authorization:"Bearer "+localStorage.getItem("token")}),console.log(s),e.next=9,t.$axios({method:"put",url:"/api/v1/book/react/"+t.id,data:o,headers:s}).then((function(e){console.log(e),t.isBookmark=!t.isBookmark,t.isBookmark?t.$notify({title:"已收藏",type:"success",position:"top-left"}):t.$notify({title:"已取消收藏",type:"success",position:"top-left"}),location.reload()})).catch((function(e){switch(console.log(e),e.response.status){case 403:t.$notify({title:"请先登录！",type:"warning",position:"top-left"});break}}));case 9:case"end":return e.stop()}}),e)})))()},selectRate:function(t){var e=this;return(0,r.Z)(regeneratorRuntime.mark((function o(){var s,a;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return console.log("rate:",t),s=new FormData,s.append("bookId",e.id),s.append("isSaved",e.isBookmark),s.append("rateScore",e.rateValue),a={},localStorage.getItem("token")&&(a={Authorization:"Bearer "+localStorage.getItem("token")}),console.log(a),o.next=10,e.$axios({method:"put",url:"/api/v1/book/react/"+e.id,data:s,headers:a}).then((function(t){switch(console.log(t),t.status){case 200:e.$notify({title:"已更新评分",type:"success",position:"top-left"});break;case 201:e.$notify({title:"已提交评分",type:"success",position:"top-left"});break}setTimeout((function(){location.reload()}),1500)})).catch((function(t){switch(console.log(t),e.rateValue=0,t.response.status){case 403:e.$notify({title:"请先登录！",type:"warning",position:"top-left"});break}}));case 10:case"end":return o.stop()}}),o)})))()},getAll:function(){var t=this;return(0,r.Z)(regeneratorRuntime.mark((function e(){var o,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$axios.all([t.getBookDetail(),t.getComment()]).then(t.$axios.spread((function(e,o){var s=e.data;t.id=s.id,t.title=s.title,t.isbn=s.isbn,t.author=s.author,t.category=t.categoryList[s.category],t.year=s.year.toString().substring(0,4),t.publish=s.publisher,t.description=s.description,t.src=s.thumbnail,t.rating=s.rating.toFixed(1),t.likeCount=s.likes,t.commentCount=o.data.count,t.comments=o.data.results,t.response=s.response,t.isBookmark=s.isSave,t.isRate=s.isRate,t.rateValue=s.score,console.log(s.score),console.log(s),console.log(s.message)}))).catch((function(t){console.log(t)}));case 2:if(!t.islogin){e.next=5;break}return e.next=5,t.$axios.get("/api/v1/user/"+t.userId).then((function(e){t.user=e.data.username,t.userAvatar=e.data.profile})).catch((function(t){console.log(t)}));case 5:o=regeneratorRuntime.mark((function e(o){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.comments[o].time=new Date(t.comments[o].createdAt).getTime(),e.next=3,t.$axios.get("api/v1/review/"+t.comments[o].id).then((function(e){t.comments[o].img=e.data.img,t.comments[o].likes=e.data.likes,t.comments[o].dislikes=e.data.dislikes})).catch((function(t){console.log(t)}));case 3:t.$axios.get("/api/v1/user/"+t.comments[o].createdBy).then((function(e){t.comments[o].publisherName=e.data.username,e.data.profile&&(t.comments[o].publisherAvatar=e.data.profile),o==t.comments.length-1&&(t.status=!0)})).catch((function(t){console.log(t)}));case 4:case"end":return e.stop()}}),e)})),s=0;case 7:if(!(s<t.comments.length)){e.next=12;break}return e.delegateYield(o(s),"t0",9);case 9:s++,e.next=7;break;case 12:case"end":return e.stop()}}),e)})))()},getBookDetail:function(){var t={};return localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/book/"+this.$route.params.id,headers:t})},getComment:function(){var t={};return localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/review/list?book="+this.$route.params.id,headers:t})},getUser:function(){return this.$axios({method:"get",url:"/api/v1/user/"+this.userId})},dateStr:function(t){var e,o=(new Date).getTime();if(o=parseInt((o-t)/1e3),o<600)return"刚刚";if(o<3600)return e=Math.floor(o/60),e+"分钟前";if(o<86400)return e=Math.floor(o/60/60),e+"小时前";if(o<432e3)return e=Math.floor(o/60/60/24),e+"天前";t=new Date(parseInt(t));var s=t.getFullYear(),a=t.getMonth()<10?"0"+(t.getMonth()+1):t.getMonth()+1,r=t.getDate()<10?"0"+t.getDate():t.getDate(),n=t.getHours()<10?"0"+t.getHours():t.getHours(),i=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes();return s+"-"+a+"-"+r+" "+n+":"+i},contentCalc:function(t){return t.replace(/(\r\n|\n|\r)/gm,"<br/>")},getImg:function(t){var e=t.target.files[0].name;$(".showFileName").html(e),this.userComment.img=t.target.files[0]},deleteImg:function(){$("#imgUpload").attr("type","text"),$("#imgUpload").attr("type","file"),$(".showFileName").html(""),this.userComment.img=""},enterProfile:function(t){this.$router.push({path:"/profile/".concat(t)})},report:function(t){this.$router.push({path:"/report/".concat(t)})},bookReload:function(){location.reload()}}},u=c,m=o(1001),p=(0,m.Z)(u,s,a,!1,null,"e516a888",null),g=p.exports},75131:function(t,e,o){t.exports=o.p+"img/Bookmark.a342d5e8.svg"},70906:function(t,e,o){t.exports=o.p+"img/Bookmark_fill.6afde71b.svg"},87970:function(t,e,o){t.exports=o.p+"img/Love.993dd4f0.svg"},392:function(t,e,o){t.exports=o.p+"img/Love_fill.98443daf.svg"},94094:function(t,e,o){t.exports=o.p+"img/Star_fill.b2d3eea1.svg"}}]);
//# sourceMappingURL=397-legacy.7d699b31.js.map