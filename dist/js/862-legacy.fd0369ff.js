"use strict";(self["webpackChunkse_project"]=self["webpackChunkse_project"]||[]).push([[862],{29862:function(t,e,o){o.r(e),o.d(e,{default:function(){return d}});var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Header"),a("div",{style:{"min-height":t.mainMinHeight+"px"},attrs:{id:"main"}},[a("div",{staticClass:"book-wrap"},[a("el-row",{attrs:{gutter:30}},[a("el-col",{attrs:{span:6}},[a("el-image",{staticClass:"poster",attrs:{src:t.src}})],1),a("el-col",{attrs:{span:14}},[a("el-row",{attrs:{id:"book-title"}},[t._v(t._s(t.title))]),a("el-row",{staticClass:"book-detail"},[a("div",{staticClass:"book-detail-prop"},[t._v("导演")]),a("div",{staticClass:"symbol"},[t._v("：")]),t._v(" "+t._s(t.director)+" ")]),a("el-row",{staticClass:"book-detail"},[a("div",{staticClass:"book-detail-prop"},[t._v("主演")]),a("div",{staticClass:"symbol"},[t._v("：")]),t._v(" "+t._s(t.actor)+" ")]),a("el-row",{staticClass:"book-detail"},[a("div",{staticClass:"book-detail-prop"},[t._v("类型")]),a("div",{staticClass:"symbol"},[t._v("：")]),t._v(" "+t._s(t.category)+" ")]),a("el-row",{staticClass:"book-detail"},[a("div",{staticClass:"book-detail-prop"},[t._v("地区")]),a("div",{staticClass:"symbol"},[t._v("：")]),t._v(" "+t._s(t.area)+" ")]),a("el-row",{staticClass:"book-detail"},[a("div",{staticClass:"book-detail-prop"},[t._v("年份")]),a("div",{staticClass:"symbol"},[t._v("：")]),t._v(" "+t._s(t.year)+" ")])],1),a("el-col",{attrs:{span:4}},[!1===t.isBookmark?a("img",{staticClass:"bookmark",attrs:{src:o(75131),alt:"bookmark"},on:{click:function(e){return t.bookmark()}}}):a("img",{staticClass:"bookmark",attrs:{src:o(70906),alt:"bookmark"},on:{click:function(e){return t.bookmark()}}}),a("el-row",{staticClass:"rate-box",attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{id:"rating",span:10}},[t._v(t._s(t.rating))]),a("el-col",{attrs:{span:8,offset:0}},[a("img",{staticClass:"rating-icon",attrs:{src:o(94094),alt:""}})])],1),a("el-rate",{attrs:{colors:t.rateColors},on:{change:function(e){return t.selectRate(t.rateValue)}},model:{value:t.rateValue,callback:function(e){t.rateValue=e},expression:"rateValue"}})],1),a("el-row",{staticClass:"book-detail",attrs:{gutter:30}},[a("el-col",{attrs:{span:17}},[a("div",{staticClass:"book-detail-prop"},[t._v("简介")]),a("div",{staticClass:"symbol"},[t._v("：")]),a("span",[t._v(" ")]),a("span",{staticStyle:{"word-wrap":"break-word"},domProps:{innerHTML:t._s(t.contentCalc(t.description))}})])],1)],1),a("el-row",{staticClass:"like-comment-wrap"},["L"===t.response?a("img",{attrs:{src:o(392),alt:"love"},on:{click:function(e){return t.like()}}}):a("img",{attrs:{src:o(87970),alt:"love"},on:{click:function(e){return t.like()}}}),a("span",{staticClass:"like-count"},[t._v(t._s(t.likeCount))]),a("img",{attrs:{src:o(82392),alt:"comment"}}),a("span",{staticClass:"comment-count"},[t._v(t._s(t.commentCount))])])],1),a("div",{staticClass:"comment-wrap"},[a("el-row",{staticClass:"comment-header"},[t._v("影评")]),a("el-divider"),t.islogin?a("el-row",{staticClass:"publish-box"},[a("el-row",{attrs:{gutter:70}},[a("el-col",{attrs:{span:1}},[t.userAvatar?a("el-avatar",{attrs:{size:50,src:t.userAvatar}}):a("el-avatar",{attrs:{size:50,icon:"el-icon-user-solid"}})],1),a("el-col",{attrs:{span:22}},[a("el-row",{staticClass:"comment-publisher"},[t._v(t._s(t.user))]),a("el-row",{staticClass:"publish-write"},[a("form",[a("input",{directives:[{name:"model",rawName:"v-model",value:t.userComment.title,expression:"userComment.title"}],attrs:{type:"text",placeholder:"书评标题："},domProps:{value:t.userComment.title},on:{input:function(e){e.target.composing||t.$set(t.userComment,"title",e.target.value)}}}),a("div",{staticClass:"comment-autosize-wrapper"},[a("pre",{staticClass:"comment-autosize"},[a("br"),t._v(t._s(t.userComment.content))]),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.userComment.content,expression:"userComment.content"}],attrs:{placeholder:"书评内容："},domProps:{value:t.userComment.content},on:{input:function(e){e.target.composing||t.$set(t.userComment,"content",e.target.value)}}})]),a("span",{staticClass:"showFileName"}),t.userComment.img?a("i",{staticClass:"el-icon-delete",staticStyle:{cursor:"pointer"},on:{click:function(e){return t.deleteImg()}}}):t._e(),a("input",{attrs:{id:"imgUpload",type:"file",accept:"image/png,image/gif,image/jpeg"},on:{change:function(e){return t.getImg(e)}}}),a("el-row",{staticClass:"publish-action",attrs:{span:20}},[a("i",{staticClass:"el-icon-picture-outline-round",attrs:{onclick:"$('input[id=imgUpload]').click();"}}),a("i",{staticClass:"el-icon-position",attrs:{id:"imgIcon"},on:{click:function(e){return t.submitReview(e)}}})])],1)])],1)],1)],1):t._e(),t._l(t.comments,(function(e){return a("el-row",{key:e.id,staticClass:"comment-box"},[a("el-divider"),a("el-row",{attrs:{gutter:70}},[a("el-col",{attrs:{span:1}},[e.publisherAvatar?a("el-avatar",{attrs:{size:50,src:e.publisherAvatar}}):a("el-avatar",{attrs:{size:50,icon:"el-icon-user-solid"}})],1),a("el-col",{attrs:{span:22}},[t.status?a("el-row",{staticClass:"comment-publisher"},[a("span",{staticStyle:{cursor:"pointer"},on:{click:function(o){return t.enterProfile(e.createdBy)}}},[t._v(" "+t._s(e.publisherName)+" ")])]):t._e(),t.status?a("el-row",{staticClass:"comment-time"},[a("i",{staticClass:"el-icon-time"}),t._v(" "+t._s(t.dateStr(e.time))+" ")]):t._e(),a("el-row",{staticClass:"comment-title"},[t._v(t._s(e.title))]),a("el-row",{staticClass:"comment-content",domProps:{innerHTML:t._s(t.contentCalc(e.description))}}),e.img?a("el-image",{staticClass:"comment-image",attrs:{src:e.img}}):t._e()],1)],1),a("el-row",{staticClass:"comment-action"},[a("el-col",{attrs:{span:3,offset:5}},[a("el-row",{attrs:{type:"flex",justify:"center"}},["L"===e.response?a("img",{attrs:{src:o(89337),alt:"happy icon"},on:{click:function(o){return t.commentResponse(e,"O")}}}):a("img",{attrs:{src:o(11816),alt:"happy icon"},on:{click:function(o){return t.commentResponse(e,"L")}}})]),a("el-row",{staticClass:"comment-like-count",attrs:{type:"flex",justify:"center"}},[t._v(t._s(e.likes))])],1),a("el-col",{attrs:{span:3,offset:1}},[a("el-row",{attrs:{type:"flex",justify:"center"}},["D"===e.response?a("img",{attrs:{src:o(24714),alt:"sad icon"},on:{click:function(o){return t.commentResponse(e,"O")}}}):a("img",{attrs:{src:o(95414),alt:"sad icon"},on:{click:function(o){return t.commentResponse(e,"D")}}})]),a("el-row",{staticClass:"comment-like-count",attrs:{type:"flex",justify:"center"}},[t._v(t._s(e.dislikes))])],1),a("el-col",{attrs:{span:3,offset:1}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("img",{attrs:{id:"report",src:o(40506),alt:"report icon"},on:{click:function(o){return t.report("r&"+e.id)}}})])],1)],1)],1)}))],2)]),a("Footer",{attrs:{id:"footer"}})],1)},s=[],r=o(16198),i=(o(41539),o(39714),o(82526),o(41817),o(56977),o(78783),o(33948),o(74916),o(15306),o(68309),o(78975),o(13083)),n=o(43445),l=o(22282),c={name:"DaoMuBiJi",components:{Header:i.Z,Footer:n.Z},data:function(){return{status:!1,islogin:!1,user:"",userId:"",userAvatar:"",id:"",title:"",director:"",actor:"",year:"",category:"悬疑",area:"中国",description:"",src:"",rating:0,likeCount:0,commentCount:0,response:"O",isBookmark:!1,userComment:{title:"",content:"",img:""},isRate:!1,rateValue:-1,rateColors:["#99A9BF","#F7BA2A","#FF9900"],comments:[],categoryList:["其他","爱情","恐怖","悬疑","冒险","喜剧","动作","科幻","综艺","动漫","卡通","LGBT"],areaList:["中国","美国","英国","韩国","日本","泰国","马来西亚"],mainMinHeight:""}},mounted:function(){var t;(t=l.Z.getters.getUser(l.Z.state()))&&(this.islogin=!0,this.userId=t.user.id),this.getAll(),this.mainMinHeight=document.documentElement.clientHeight-$("#header").outerHeight(!0)-$("#footer").outerHeight(!0)-6},watch:{$route:{handler:"movieReload"}},methods:{commentResponse:function(t,e){var o=this;return(0,r.Z)(regeneratorRuntime.mark((function a(){var s,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=new FormData,s.append("response",e),s.append("reviewId",t.id),r={},localStorage.getItem("token")&&(r={Authorization:"Bearer "+localStorage.getItem("token")}),a.next=7,o.$axios({method:"put",url:"/api/v1/review/react/"+t.id,data:s,headers:r}).then((function(o){console.log(o),"O"==t.response?"L"==e?t.likes++:t.dislikes++:"L"==t.response?"O"==e?t.likes--:(t.likes--,t.dislikes++):("O"==e||t.likes++,t.dislikes--),t.response=e})).catch((function(t){switch(console.log(t),t.response.status){case 403:o.$notify({title:"请先登录",type:"warning",position:"top-left"});break}}));case 7:case"end":return a.stop()}}),a)})))()},submitReview:function(t){var e=this;t.preventDefault();var o=new FormData;o.append("title",this.userComment.title),o.append("description",this.userComment.content),o.append("img",this.userComment.img),o.append("book",""),o.append("feed",""),o.append("movie",this.id);var a={};localStorage.getItem("token")&&(a={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"post",url:"/api/v1/review/",data:o,headers:a}).then((function(t){switch(console.log(t),t.status){case 201:e.$notify({showClose:!0,message:"已发布评论",type:"success",position:"top-left"}),setTimeout((function(){location.reload()}),1500);break}})).catch((function(t){switch(console.log(t),t.response.status){case 400:e.userComment.title.length>150?e.$notify({title:"标题长度不可超过150字符！",type:"warning",position:"top-left"}):e.userComment.content.length>5e3?e.$notify({title:"内容长度不可超过5000字符！",type:"warning",position:"top-left"}):e.$notify({title:"标题和内容不能为空！",type:"warning",position:"top-left"});break}}))},like:function(){var t=this;return(0,r.Z)(regeneratorRuntime.mark((function e(){var o,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o="L"==t.response?"O":"L",a=new FormData,a.append("response",o),a.append("movieId",t.id),a.append("rateScore",t.rateValue),s={},localStorage.getItem("token")&&(s={Authorization:"Bearer "+localStorage.getItem("token")}),console.log(s),e.next=10,t.$axios({method:"put",url:"/api/v1/movie/react/"+t.id,data:a,headers:s}).then((function(e){console.log(e),t.response=o,"L"==t.response?t.likeCount++:t.likeCount--})).catch((function(e){switch(console.log(e),e.response.status){case 403:t.$notify({title:"请先登录",type:"warning",position:"top-left"});break}}));case 10:case"end":return e.stop()}}),e)})))()},bookmark:function(){var t=this;return(0,r.Z)(regeneratorRuntime.mark((function e(){var o,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return o=new FormData,o.append("isSaved",!t.isBookmark),o.append("movieId",t.id),o.append("rateScore",t.rateValue),a={},localStorage.getItem("token")&&(a={Authorization:"Bearer "+localStorage.getItem("token")}),console.log(a),e.next=9,t.$axios({method:"put",url:"/api/v1/movie/react/"+t.id,data:o,headers:a}).then((function(e){console.log(e),t.isBookmark=!t.isBookmark,t.isBookmark?t.$notify({title:"已收藏",type:"success",position:"top-left"}):t.$notify({title:"已取消收藏",type:"success",position:"top-left"}),location.reload()})).catch((function(e){switch(console.log(e),e.response.status){case 403:t.$notify({title:"请先登录！",type:"warning",position:"top-left"});break}}));case 9:case"end":return e.stop()}}),e)})))()},selectRate:function(t){var e=this;return(0,r.Z)(regeneratorRuntime.mark((function t(){var o,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o=new FormData,o.append("movieId",e.id),o.append("isSaved",e.isBookmark),o.append("rateScore",e.rateValue),a={},localStorage.getItem("token")&&(a={Authorization:"Bearer "+localStorage.getItem("token")}),t.next=8,e.$axios({method:"put",url:"/api/v1/movie/react/"+e.id,data:o,headers:a}).then((function(t){switch(console.log(t),t.status){case 200:e.$notify({title:"已更新评分",type:"success",position:"top-left"});break;case 201:e.$notify({title:"已提交评分",type:"success",position:"top-left"});break}setTimeout((function(){location.reload()}),1500)})).catch((function(t){switch(console.log(t),e.rateValue=0,t.response.status){case 403:e.$notify({title:"请先登录！",type:"warning",position:"top-left"});break}}));case 8:case"end":return t.stop()}}),t)})))()},getAll:function(){var t=this;return(0,r.Z)(regeneratorRuntime.mark((function e(){var o,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$axios.all([t.getMovieDetail(),t.getComment()]).then(t.$axios.spread((function(e,o){var a=e.data;t.id=a.id,t.title=a.title,t.director=a.director,t.actor=a.actor,t.category=t.categoryList[a.category],t.area=t.areaList[a.area],t.year=a.year.toString().substring(0,4),t.description=a.description,t.src=a.thumbnail,t.rating=a.rating.toFixed(1),t.likeCount=a.likes,t.commentCount=o.data.count,t.comments=o.data.results,t.response=a.response,t.isBookmark=a.isSave,t.isRate=a.isRate,t.rateValue=a.score,console.log(a.message)}))).catch((function(t){console.log(t)}));case 2:if(!t.islogin){e.next=5;break}return e.next=5,t.$axios.get("/api/v1/user/"+t.userId).then((function(e){t.user=e.data.username,t.userAvatar=e.data.profile})).catch((function(t){console.log(t)}));case 5:o=regeneratorRuntime.mark((function e(o){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.comments[o].time=new Date(t.comments[o].createdAt).getTime(),e.next=3,t.$axios.get("api/v1/review/"+t.comments[o].id).then((function(e){t.comments[o].img=e.data.img,t.comments[o].likes=e.data.likes,t.comments[o].dislikes=e.data.dislikes})).catch((function(t){console.log(t)}));case 3:t.$axios.get("/api/v1/user/"+t.comments[o].createdBy).then((function(e){t.comments[o].publisherName=e.data.username,e.data.profile&&(t.comments[o].publisherAvatar=e.data.profile),o==t.comments.length-1&&(t.status=!0)})).catch((function(t){console.log(t)}));case 4:case"end":return e.stop()}}),e)})),a=0;case 7:if(!(a<t.comments.length)){e.next=12;break}return e.delegateYield(o(a),"t0",9);case 9:a++,e.next=7;break;case 12:case"end":return e.stop()}}),e)})))()},getMovieDetail:function(){var t={};return localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),console.log(t),this.$axios({method:"get",url:"/api/v1/movie/"+this.$route.params.id,headers:t})},getComment:function(){var t={};return localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),console.log(t),this.$axios({method:"get",url:"/api/v1/review/list?movie="+this.$route.params.id,headers:t})},getUser:function(){return this.$axios({method:"get",url:"/api/v1/user/"+this.userId})},dateStr:function(t){var e,o=(new Date).getTime();if(o=parseInt((o-t)/1e3),o<600)return"刚刚";if(o<3600)return e=Math.floor(o/60),e+"分钟前";if(o<86400)return e=Math.floor(o/60/60),e+"小时前";if(o<432e3)return e=Math.floor(o/60/60/24),e+"天前";t=new Date(parseInt(t));var a=t.getFullYear(),s=t.getMonth()<10?"0"+(t.getMonth()+1):t.getMonth()+1,r=t.getDate()<10?"0"+t.getDate():t.getDate(),i=t.getHours()<10?"0"+t.getHours():t.getHours(),n=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes();return a+"-"+s+"-"+r+" "+i+":"+n},contentCalc:function(t){return t.replace(/(\r\n|\n|\r)/gm,"<br/>")},getImg:function(t){var e=t.target.files[0].name;$(".showFileName").html(e),this.userComment.img=t.target.files[0]},deleteImg:function(){$("#imgUpload").attr("type","text"),$("#imgUpload").attr("type","file"),$(".showFileName").html(""),this.userComment.img=""},enterProfile:function(t){this.$router.push({path:"/profile/".concat(t)})},report:function(t){this.$router.push({path:"/report/".concat(t)})},movieReload:function(){location.reload()}}},u=c,m=o(1001),p=(0,m.Z)(u,a,s,!1,null,"4684e005",null),d=p.exports},75131:function(t,e,o){t.exports=o.p+"img/Bookmark.a342d5e8.svg"},70906:function(t,e,o){t.exports=o.p+"img/Bookmark_fill.6afde71b.svg"},87970:function(t,e,o){t.exports=o.p+"img/Love.993dd4f0.svg"},392:function(t,e,o){t.exports=o.p+"img/Love_fill.98443daf.svg"},94094:function(t,e,o){t.exports=o.p+"img/Star_fill.b2d3eea1.svg"}}]);
//# sourceMappingURL=862-legacy.fd0369ff.js.map