"use strict";(self["webpackChunkse_project"]=self["webpackChunkse_project"]||[]).push([[397],{6397:function(t,e,s){s.r(e),s.d(e,{default:function(){return u}});var o=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("Header",{attrs:{id:"header"}}),o("div",{style:{"min-height":t.mainMinHeight+"px"},attrs:{id:"main"}},[o("div",{staticClass:"book-wrap"},[o("el-row",{attrs:{gutter:30}},[o("el-col",{attrs:{span:6}},[o("el-image",{staticClass:"poster",attrs:{src:t.src}})],1),o("el-col",{attrs:{span:14}},[o("el-row",{attrs:{id:"book-title"}},[t._v(t._s(t.title))]),o("el-row",{staticClass:"book-detail"},[o("div",{staticClass:"book-detail-prop"},[t._v("作者")]),o("div",{staticClass:"symbol"},[t._v("：")]),t._v(" "+t._s(t.author)+" ")]),o("el-row",{staticClass:"book-detail"},[o("div",{staticClass:"book-detail-prop"},[t._v("类型")]),o("div",{staticClass:"symbol"},[t._v("：")]),t._v(" "+t._s(t.category)+" ")]),o("el-row",{staticClass:"book-detail"},[o("div",{staticClass:"book-detail-prop"},[t._v("年份")]),o("div",{staticClass:"symbol"},[t._v("：")]),t._v(" "+t._s(t.year)+" ")]),o("el-row",{staticClass:"book-detail"},[o("div",{staticClass:"book-detail-prop"},[t._v("出版社")]),o("div",{staticClass:"symbol"},[t._v("：")]),t._v(" "+t._s(t.publish)+" ")])],1),o("el-col",{attrs:{span:4}},[!1===t.isBookmark?o("img",{staticClass:"bookmark",attrs:{src:s(5131),alt:"bookmark"},on:{click:function(e){return t.bookmark()}}}):o("img",{staticClass:"bookmark",attrs:{src:s(906),alt:"bookmark"},on:{click:function(e){return t.bookmark()}}}),o("el-row",{staticClass:"rate-box",attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{id:"rating",span:10}},[t._v(t._s(t.rating))]),o("el-col",{attrs:{span:8,offset:0}},[o("img",{staticClass:"rating-icon",attrs:{src:s(4094),alt:""}})])],1),o("el-rate",{attrs:{colors:t.rateColors},on:{change:function(e){return t.selectRate(t.rateValue)}},model:{value:t.rateValue,callback:function(e){t.rateValue=e},expression:"rateValue"}})],1),o("el-row",{staticClass:"book-detail",attrs:{gutter:30}},[o("el-col",{attrs:{span:17}},[o("div",{staticClass:"book-detail-prop"},[t._v("简介")]),o("div",{staticClass:"symbol"},[t._v("：")]),o("span",[t._v(" ")]),o("span",{staticStyle:{"word-wrap":"break-word"},domProps:{innerHTML:t._s(t.contentCalc(t.description))}})])],1)],1),o("el-row",{staticClass:"like-comment-wrap"},["L"===t.response?o("img",{attrs:{src:s(392),alt:"love"},on:{click:function(e){return t.like()}}}):o("img",{attrs:{src:s(7970),alt:"love"},on:{click:function(e){return t.like()}}}),o("span",{staticClass:"like-count"},[t._v(t._s(t.likeCount))]),o("img",{attrs:{src:s(2392),alt:"comment"}}),o("span",{staticClass:"comment-count"},[t._v(t._s(t.commentCount))])])],1),o("div",{staticClass:"comment-wrap"},[o("el-row",{staticClass:"comment-header"},[t._v("书评")]),o("el-divider"),t.islogin?o("el-row",{staticClass:"publish-box"},[o("el-row",{attrs:{gutter:70}},[o("el-col",{attrs:{span:1}},[t.userAvatar?o("el-avatar",{attrs:{size:50,src:t.userAvatar}}):o("el-avatar",{attrs:{size:50,icon:"el-icon-user-solid"}})],1),o("el-col",{attrs:{span:22}},[o("el-row",{staticClass:"comment-publisher"},[t._v(t._s(t.user))]),o("el-row",{staticClass:"publish-write"},[o("form",[o("input",{directives:[{name:"model",rawName:"v-model",value:t.userComment.title,expression:"userComment.title"}],attrs:{type:"text",placeholder:"书评标题："},domProps:{value:t.userComment.title},on:{input:function(e){e.target.composing||t.$set(t.userComment,"title",e.target.value)}}}),o("div",{staticClass:"comment-autosize-wrapper"},[o("pre",{staticClass:"comment-autosize"},[t._v("                    "),o("br"),t._v(t._s(t.userComment.content)+"\n                  ")]),o("textarea",{directives:[{name:"model",rawName:"v-model",value:t.userComment.content,expression:"userComment.content"}],attrs:{placeholder:"书评内容："},domProps:{value:t.userComment.content},on:{input:function(e){e.target.composing||t.$set(t.userComment,"content",e.target.value)}}})]),o("span",{staticClass:"showFileName"}),t.userComment.img?o("i",{staticClass:"el-icon-delete",staticStyle:{cursor:"pointer"},on:{click:function(e){return t.deleteImg()}}}):t._e(),o("input",{attrs:{id:"imgUpload",type:"file",accept:"image/png,image/gif,image/jpeg"},on:{change:function(e){return t.getImg(e)}}}),o("el-row",{staticClass:"publish-action",attrs:{span:20}},[o("i",{staticClass:"el-icon-picture-outline-round",attrs:{onclick:"$('input[id=imgUpload]').click();"}}),o("i",{staticClass:"el-icon-position",attrs:{id:"imgIcon"},on:{click:function(e){return t.submitReview(e)}}})])],1)])],1)],1)],1):t._e(),t._l(t.comments,(function(e){return o("el-row",{key:e.id,staticClass:"comment-box"},[o("el-divider"),o("el-row",{attrs:{gutter:70}},[o("el-col",{attrs:{span:1}},[e.publisherAvatar?o("el-avatar",{attrs:{size:50,src:e.publisherAvatar}}):o("el-avatar",{attrs:{size:50,icon:"el-icon-user-solid"}})],1),o("el-col",{attrs:{span:22}},[t.status?o("el-row",{staticClass:"comment-publisher"},[o("span",{staticStyle:{cursor:"pointer"},on:{click:function(s){return t.enterProfile(e.createdBy)}}},[t._v(" "+t._s(e.publisherName)+" ")])]):t._e(),t.status?o("el-row",{staticClass:"comment-time"},[o("i",{staticClass:"el-icon-time"}),t._v(" "+t._s(t.dateStr(e.time))+" ")]):t._e(),o("el-row",{staticClass:"comment-title"},[t._v(t._s(e.title))]),o("el-row",{staticClass:"comment-content",domProps:{innerHTML:t._s(t.contentCalc(e.description))}}),e.img?o("el-image",{staticClass:"comment-image",attrs:{src:e.img}}):t._e()],1)],1),o("el-row",{staticClass:"comment-action"},[o("el-col",{attrs:{span:3,offset:5}},[o("el-row",{attrs:{type:"flex",justify:"center"}},["L"===e.response?o("img",{attrs:{src:s(9337),alt:"happy icon"},on:{click:function(s){return t.commentResponse(e,"O")}}}):o("img",{attrs:{src:s(1816),alt:"happy icon"},on:{click:function(s){return t.commentResponse(e,"L")}}})]),o("el-row",{staticClass:"comment-like-count",attrs:{type:"flex",justify:"center"}},[t._v(" "+t._s(e.likes)+" ")])],1),o("el-col",{attrs:{span:3,offset:1}},[o("el-row",{attrs:{type:"flex",justify:"center"}},["D"===e.response?o("img",{attrs:{src:s(4714),alt:"sad icon"},on:{click:function(s){return t.commentResponse(e,"O")}}}):o("img",{attrs:{src:s(5414),alt:"sad icon"},on:{click:function(s){return t.commentResponse(e,"D")}}})]),o("el-row",{staticClass:"comment-like-count",attrs:{type:"flex",justify:"center"}},[t._v(" "+t._s(e.dislikes)+" ")])],1),o("el-col",{attrs:{span:3,offset:1}},[o("el-row",{attrs:{type:"flex",justify:"center"}},[o("img",{attrs:{id:"report",src:s(506),alt:"report icon"},on:{click:function(s){return t.report("r&"+e.id)}}})])],1)],1)],1)}))],2)]),o("Footer",{attrs:{id:"footer"}})],1)},a=[],i=s(3083),r=s(3445),n=s(2282),l={name:"BookInnerpage",components:{Header:i.Z,Footer:r.Z},data(){return{status:!1,islogin:!1,user:"",userId:"",userAvatar:"",id:"",title:"",isbn:"",author:"",category:"",year:"",publish:"",description:"",src:"",rating:0,likeCount:0,commentCount:0,response:"O",isBookmark:!1,userComment:{title:"",content:"",img:""},isRate:!1,rateValue:-1,rateColors:["#99A9BF","#F7BA2A","#FF9900"],comments:[],categoryList:["其他","爱情","恐怖","悬疑","科幻","艺术","体育","烹饪","漫画","教育","哲学","文学"],mainMinHeight:""}},mounted(){var t;(t=n.Z.getters.getUser(n.Z.state()))&&(this.islogin=!0,this.userId=t.user.id),this.getAll(),this.mainMinHeight=document.documentElement.clientHeight-$("#header").outerHeight(!0)-$("#footer").outerHeight(!0)-6},watch:{$route:{handler:"bookReload"}},methods:{async commentResponse(t,e){var s=new FormData;s.append("response",e),s.append("reviewId",t.id);var o={};localStorage.getItem("token")&&(o={Authorization:"Bearer "+localStorage.getItem("token")}),console.log(o),await this.$axios({method:"put",url:"/api/v1/review/react/"+t.id,data:s,headers:o}).then((s=>{console.log(s),"O"==t.response?"L"==e?t.likes++:t.dislikes++:"L"==t.response?"O"==e?t.likes--:(t.likes--,t.dislikes++):("O"==e||t.likes++,t.dislikes--),t.response=e})).catch((t=>{switch(console.log(t),t.response.status){case 403:this.$notify({title:"请先登录",type:"warning",position:"top-left"});break}}))},submitReview(t){t.preventDefault();let e=new FormData;e.append("title",this.userComment.title),e.append("description",this.userComment.content),e.append("img",this.userComment.img),e.append("feed",""),e.append("book",this.id),e.append("movie","");var s={};localStorage.getItem("token")&&(s={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"post",url:"/api/v1/review/",data:e,headers:s}).then((t=>{switch(console.log(t),t.status){case 201:this.$notify({showClose:!0,message:"已发布评论",type:"success",position:"top-left"}),setTimeout((function(){location.reload()}),1500);break}})).catch((t=>{switch(console.log(t),t.response.status){case 400:this.userComment.title.length>150?this.$notify({title:"标题长度不可超过150字符！",type:"warning",position:"top-left"}):this.userComment.content.length>5e3?this.$notify({title:"内容长度不可超过5000字符！",type:"warning",position:"top-left"}):this.$notify({title:"标题和内容不能为空！",type:"warning",position:"top-left"});break}}))},async like(){var t;t="L"==this.response?"O":"L";var e=new FormData;e.append("response",t),e.append("bookId",this.id),e.append("rateScore",this.rateValue);var s={};localStorage.getItem("token")&&(s={Authorization:"Bearer "+localStorage.getItem("token")}),console.log(localStorage.getItem("token")),console.log(s),await this.$axios({method:"put",url:"/api/v1/book/react/"+this.id,data:e,headers:s}).then((e=>{console.log(e),this.response=t,"L"==this.response?this.likeCount++:this.likeCount--})).catch((t=>{switch(console.log(t),t.response.status){case 403:this.$notify({title:"请先登录",type:"warning",position:"top-left"});break}}))},async bookmark(){var t=new FormData;t.append("isSaved",!this.isBookmark),t.append("bookId",this.id),t.append("rateScore",this.rateValue);var e={};localStorage.getItem("token")&&(e={Authorization:"Bearer "+localStorage.getItem("token")}),console.log(e),await this.$axios({method:"put",url:"/api/v1/book/react/"+this.id,data:t,headers:e}).then((t=>{console.log(t),this.isBookmark=!this.isBookmark,this.isBookmark?this.$notify({title:"已收藏",type:"success",position:"top-left"}):this.$notify({title:"已取消收藏",type:"success",position:"top-left"}),location.reload()})).catch((t=>{switch(console.log(t),t.response.status){case 403:this.$notify({title:"请先登录！",type:"warning",position:"top-left"});break}}))},async selectRate(t){console.log("rate:",t);var e=new FormData;e.append("bookId",this.id),e.append("isSaved",this.isBookmark),e.append("rateScore",this.rateValue);var s={};localStorage.getItem("token")&&(s={Authorization:"Bearer "+localStorage.getItem("token")}),console.log(s),await this.$axios({method:"put",url:"/api/v1/book/react/"+this.id,data:e,headers:s}).then((t=>{switch(console.log(t),t.status){case 200:this.$notify({title:"已更新评分",type:"success",position:"top-left"});break;case 201:this.$notify({title:"已提交评分",type:"success",position:"top-left"});break}setTimeout((function(){location.reload()}),1500)})).catch((t=>{switch(console.log(t),this.rateValue=0,t.response.status){case 403:this.$notify({title:"请先登录！",type:"warning",position:"top-left"});break}}))},async getAll(){await this.$axios.all([this.getBookDetail(),this.getComment()]).then(this.$axios.spread(((t,e)=>{var s=t.data;this.id=s.id,this.title=s.title,this.isbn=s.isbn,this.author=s.author,this.category=this.categoryList[s.category],this.year=s.year.toString().substring(0,4),this.publish=s.publisher,this.description=s.description,this.src=s.thumbnail,this.rating=s.rating.toFixed(1),this.likeCount=s.likes,this.commentCount=e.data.count,this.comments=e.data.results,this.response=s.response,this.isBookmark=s.isSave,this.isRate=s.isRate,this.rateValue=s.score,console.log(s.score),console.log(s),console.log(s.message)}))).catch((t=>{console.log(t)})),this.islogin&&await this.$axios.get("/api/v1/user/"+this.userId).then((t=>{this.user=t.data.username,this.userAvatar=t.data.profile})).catch((t=>{console.log(t)}));for(let t=0;t<this.comments.length;t++)this.comments[t].time=new Date(this.comments[t].createdAt).getTime(),await this.$axios.get("api/v1/review/"+this.comments[t].id).then((e=>{this.comments[t].img=e.data.img,this.comments[t].likes=e.data.likes,this.comments[t].dislikes=e.data.dislikes})).catch((t=>{console.log(t)})),this.$axios.get("/api/v1/user/"+this.comments[t].createdBy).then((e=>{this.comments[t].publisherName=e.data.username,e.data.profile&&(this.comments[t].publisherAvatar=e.data.profile),t==this.comments.length-1&&(this.status=!0)})).catch((t=>{console.log(t)}))},getBookDetail(){var t={};return localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/book/"+this.$route.params.id,headers:t})},getComment(){var t={};return localStorage.getItem("token")&&(t={Authorization:"Bearer "+localStorage.getItem("token")}),this.$axios({method:"get",url:"/api/v1/review/list?book="+this.$route.params.id,headers:t})},getUser(){return this.$axios({method:"get",url:"/api/v1/user/"+this.userId})},dateStr(t){var e,s=(new Date).getTime();if(s=parseInt((s-t)/1e3),s<600)return"刚刚";if(s<3600)return e=Math.floor(s/60),e+"分钟前";if(s<86400)return e=Math.floor(s/60/60),e+"小时前";if(s<432e3)return e=Math.floor(s/60/60/24),e+"天前";{t=new Date(parseInt(t));let e=t.getFullYear(),s=t.getMonth()<10?"0"+(t.getMonth()+1):t.getMonth()+1,o=t.getDate()<10?"0"+t.getDate():t.getDate(),a=t.getHours()<10?"0"+t.getHours():t.getHours(),i=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes();return e+"-"+s+"-"+o+" "+a+":"+i}},contentCalc(t){return t.replace(/(\r\n|\n|\r)/gm,"<br/>")},getImg(t){var e=t.target.files[0].name;$(".showFileName").html(e),this.userComment.img=t.target.files[0]},deleteImg(){$("#imgUpload").attr("type","text"),$("#imgUpload").attr("type","file"),$(".showFileName").html(""),this.userComment.img=""},enterProfile(t){this.$router.push({path:`/profile/${t}`})},report(t){this.$router.push({path:`/report/${t}`})},bookReload(){location.reload()}}},c=l,m=s(1001),p=(0,m.Z)(c,o,a,!1,null,"e516a888",null),u=p.exports},5131:function(t,e,s){t.exports=s.p+"img/Bookmark.a342d5e8.svg"},906:function(t,e,s){t.exports=s.p+"img/Bookmark_fill.6afde71b.svg"},7970:function(t,e,s){t.exports=s.p+"img/Love.993dd4f0.svg"},392:function(t,e,s){t.exports=s.p+"img/Love_fill.98443daf.svg"},4094:function(t,e,s){t.exports=s.p+"img/Star_fill.b2d3eea1.svg"}}]);
//# sourceMappingURL=397.c9706cd9.js.map